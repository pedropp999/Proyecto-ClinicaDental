@model Proyecto_DentalNova.Models.PacienteViewModel.PacienteVM

<div class="row g-4">

    <div class="col-12 col-lg-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white py-3">
                <h6 class="m-0 fw-bold text-primary"><i class="fas fa-user-link me-2"></i> Datos de Afiliación</h6>
            </div>
            <div class="card-body">

                <div class="mb-4">
                    <label asp-for="Paciente.UsuarioId" class="form-label fw-bold small text-muted text-uppercase">Usuario de Sistema</label>
                    <div class="input-group flex-nowrap">
                        <span class="input-group-text bg-light"><i class="fas fa-user"></i></span>
                        <div class="flex-grow-1" style="min-width: 0;">
                            <select asp-for="Paciente.UsuarioId" class="form-select select2-usuario" id="usuarioSelect" style="width: 100%;">
                                <option value="">Buscar usuario...</option>
                                @foreach (var usuario in Model.UsuariosDisponibles)
                                {
                                    <option value="@usuario.Id"
                                            data-fecha-nacimiento="@(usuario.FechaNacimiento?.ToString("yyyy-MM-dd"))">
                                        @usuario.TextoMostrar
                                    </option>
                                }
                            </select>
                        </div>
                    </div>
                    <span asp-validation-for="Paciente.UsuarioId" class="text-danger small"></span>
                    <div class="form-text small mt-2">
                        <i class="fas fa-info-circle me-1"></i> Seleccione un usuario existente para crear su expediente médico.
                    </div>
                </div>

                <div class="mb-3">
                    <label asp-for="Paciente.Edad" class="form-label fw-bold small text-muted text-uppercase">Edad (Años)</label>
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-birthday-cake text-primary"></i></span>
                        <input asp-for="Paciente.Edad" type="number" class="form-control bg-light border-start-0 fw-bold text-primary" id="edadInput" readonly />
                    </div>
                    <span asp-validation-for="Paciente.Edad" class="text-danger small"></span>
                    <div class="form-text small">Calculada automáticamente según fecha de nacimiento.</div>
                </div>

            </div>
        </div>
    </div>

    <div class="col-12 col-lg-8">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white py-3">
                <h6 class="m-0 fw-bold text-primary"><i class="fas fa-notes-medical me-2"></i> Antecedentes Médicos</h6>
            </div>
            <div class="card-body">

                <div class="alert alert-light border mb-4 small text-muted">
                    <i class="fas fa-check-square me-2 text-success"></i> Marque las casillas correspondientes y especifique los detalles.
                </div>

                <div class="row g-3">
                    <div class="col-12">
                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <div class="form-check form-switch mb-2">
                                    <input asp-for="Paciente.ConAlergias" class="form-check-input" type="checkbox" role="switch" data-bs-toggle="collapse" data-bs-target="#collapseAlergias" />
                                    <label asp-for="Paciente.ConAlergias" class="form-check-label fw-bold">¿Padece Alergias?</label>
                                </div>
                                <div class="collapse @(Model.Paciente.ConAlergias ? "show" : "")" id="collapseAlergias">
                                    <textarea asp-for="Paciente.Alergias" class="form-control mt-2" rows="2" placeholder="Ej. Penicilina, Látex, Polvo..."></textarea>
                                    <span asp-validation-for="Paciente.Alergias" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <div class="form-check form-switch mb-2">
                                    <input asp-for="Paciente.ConEnfermedadesCronicas" class="form-check-input" type="checkbox" role="switch" data-bs-toggle="collapse" data-bs-target="#collapseCronicas" />
                                    <label asp-for="Paciente.ConEnfermedadesCronicas" class="form-check-label fw-bold">¿Enfermedades Crónicas?</label>
                                </div>
                                <div class="collapse @(Model.Paciente.ConEnfermedadesCronicas ? "show" : "")" id="collapseCronicas">
                                    <textarea asp-for="Paciente.EnfermedadesCronicas" class="form-control mt-2" rows="2" placeholder="Ej. Diabetes Tipo 2, Hipertensión..."></textarea>
                                    <span asp-validation-for="Paciente.EnfermedadesCronicas" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <div class="form-check form-switch mb-2">
                                    <input asp-for="Paciente.ConMedicamentosActuales" class="form-check-input" type="checkbox" role="switch" data-bs-toggle="collapse" data-bs-target="#collapseMedicamentos" />
                                    <label asp-for="Paciente.ConMedicamentosActuales" class="form-check-label fw-bold">¿Toma Medicamentos Actualmente?</label>
                                </div>
                                <div class="collapse @(Model.Paciente.ConMedicamentosActuales ? "show" : "")" id="collapseMedicamentos">
                                    <textarea asp-for="Paciente.MedicamentosActuales" class="form-control mt-2" rows="2" placeholder="Ej. Losartán 50mg cada 12hrs..."></textarea>
                                    <span asp-validation-for="Paciente.MedicamentosActuales" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <div class="form-check form-switch mb-2">
                                    <input asp-for="Paciente.ConAntecedentesFamiliares" class="form-check-input" type="checkbox" role="switch" data-bs-toggle="collapse" data-bs-target="#collapseAntecedentes" />
                                    <label asp-for="Paciente.ConAntecedentesFamiliares" class="form-check-label fw-bold">Antecedentes Familiares Relevantes</label>
                                </div>
                                <div class="collapse @(Model.Paciente.ConAntecedentesFamiliares ? "show" : "")" id="collapseAntecedentes">
                                    <textarea asp-for="Paciente.AntecedentesFamiliares" class="form-control mt-2" rows="2" placeholder="Ej. Padre con problemas cardíacos..."></textarea>
                                    <span asp-validation-for="Paciente.AntecedentesFamiliares" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <label asp-for="Paciente.Observaciones" class="form-label fw-bold small text-muted text-uppercase">Notas Adicionales</label>
                    <textarea asp-for="Paciente.Observaciones" class="form-control" rows="3" placeholder="Cualquier otro dato relevante para el odontólogo..."></textarea>
                </div>

            </div>
        </div>
    </div>
</div>
@* @model Proyecto_DentalNova.Models.PacienteViewModel.PacienteVM;

<div class="card shadow-sm">
    <div class="card-body p-4">

        <h4><i class="bi bi-person-check-fill"></i> Asignación de Usuario</h4>
        <hr class="mt-2 mb-4">
        <div class="form-group mb-3">
            <label asp-for="Paciente.UsuarioId" class="form-label"></label>
            <select asp-for="Paciente.UsuarioId" class="form-select" id="usuarioSelect">
                <option value="">-- Seleccione un Usuario para asignar como Paciente --</option>
                @foreach (var usuario in Model.UsuariosDisponibles)
                {
                    // Añadimos el atributo data-fecha-nacimiento
                    <option value="@usuario.Id"
                            data-fecha-nacimiento="@(usuario.FechaNacimiento?.ToString("yyyy-MM-dd"))">
                        @usuario.TextoMostrar
                    </option>
                }
            </select>
            <span asp-validation-for="Paciente.UsuarioId" class="text-danger"></span>
            <div class="form-text">Solo se muestran los usuarios activos que aún no han sido asignados como pacientes.</div>
        </div>
        <div class="form-group mb-3">
            <label asp-for="Paciente.Edad" class="form-label"></label>
            <input asp-for="Paciente.Edad" type="number" class="form-control" placeholder="Edad del paciente en años" id="edadInput" />
            <span asp-validation-for="Paciente.Edad" class="text-danger"></span>
        </div>


        <h4 class="mt-5"><i class="bi bi-file-earmark-medical-fill"></i> Historial Clínico</h4>
        <hr class="mt-2 mb-4">

        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-check">
                    <input asp-for="Paciente.ConAlergias" class="form-check-input" type="checkbox" data-bs-toggle="collapse" data-bs-target="#alergiasCollapse" />
                    <label asp-for="Paciente.ConAlergias" class="form-check-label"></label>
                </div>
                <div class="collapse @(Model.Paciente.ConAlergias ? "show" : "")" id="alergiasCollapse">
                    <textarea asp-for="Paciente.Alergias" class="form-control mt-2" rows="3" placeholder="Especifique las alergias..."></textarea>
                    <span asp-validation-for="Paciente.Alergias" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="form-check">
                    <input asp-for="Paciente.ConEnfermedadesCronicas" class="form-check-input" type="checkbox" data-bs-toggle="collapse" data-bs-target="#enfermedadesCollapse" />
                    <label asp-for="Paciente.ConEnfermedadesCronicas" class="form-check-label"></label>
                </div>
                <div class="collapse @(Model.Paciente.ConEnfermedadesCronicas ? "show" : "")" id="enfermedadesCollapse">
                    <textarea asp-for="Paciente.EnfermedadesCronicas" class="form-control mt-2" rows="3" placeholder="Especifique las enfermedades..."></textarea>
                    <span asp-validation-for="Paciente.EnfermedadesCronicas" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-check">
                    <input asp-for="Paciente.ConMedicamentosActuales" class="form-check-input" type="checkbox" data-bs-toggle="collapse" data-bs-target="#medicamentosCollapse" />
                    <label asp-for="Paciente.ConMedicamentosActuales" class="form-check-label"></label>
                </div>
                <div class="collapse @(Model.Paciente.ConMedicamentosActuales ? "show" : "")" id="medicamentosCollapse">
                    <textarea asp-for="Paciente.MedicamentosActuales" class="form-control mt-2" rows="3" placeholder="Especifique los medicamentos..."></textarea>
                    <span asp-validation-for="Paciente.MedicamentosActuales" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="form-check">
                    <input asp-for="Paciente.ConAntecedentesFamiliares" class="form-check-input" type="checkbox" data-bs-toggle="collapse" data-bs-target="#antecedentesCollapse" />
                    <label asp-for="Paciente.ConAntecedentesFamiliares" class="form-check-label"></label>
                </div>
                <div class="collapse @(Model.Paciente.ConAntecedentesFamiliares ? "show" : "")" id="antecedentesCollapse">
                    <textarea asp-for="Paciente.AntecedentesFamiliares" class="form-control mt-2" rows="3" placeholder="Especifique los antecedentes..."></textarea>
                    <span asp-validation-for="Paciente.AntecedentesFamiliares" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="form-group mb-3">
            <label asp-for="Paciente.Observaciones" class="form-label"></label>
            <textarea asp-for="Paciente.Observaciones" class="form-control" rows="4" placeholder="Anotaciones adicionales sobre el paciente..."></textarea>
            <span asp-validation-for="Paciente.Observaciones" class="text-danger"></span>
        </div>
    </div>
</div> *@